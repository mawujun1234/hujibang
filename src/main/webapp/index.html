<!doctype html>
<html class="no-js">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="description" content="">
  <meta name="keywords" content="">
  <meta name="viewport"
        content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <title>护脊帮</title>

  <!-- Set render engine for 360 browser -->
  <meta name="renderer" content="webkit">

  <!-- No Baidu Siteapp-->
  <meta http-equiv="Cache-Control" content="no-siteapp"/>

  <link rel="icon" type="image/png" href="assets/i/favicon.png">

  <!-- Add to homescreen for Chrome on Android -->
  <meta name="mobile-web-app-capable" content="yes">
  <link rel="icon" sizes="192x192" href="assets/i/app-icon72x72@2x.png">

  <!-- Add to homescreen for Safari on iOS -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="apple-mobile-web-app-title" content="Amaze UI"/>
  <link rel="apple-touch-icon-precomposed" href="assets/i/app-icon72x72@2x.png">

  <!-- Tile icon for Win8 (144x144 + tile color) -->
  <meta name="msapplication-TileImage" content="assets/i/app-icon72x72@2x.png">
  <meta name="msapplication-TileColor" content="#0e90d2">

  <link rel="stylesheet" href="assets/css/amazeui.min.css">
  <link rel="stylesheet" href="assets/css/app.css">
  <!--
  	<link rel="stylesheet" type="text/css" href="http://as.51jlt.com/style/base/global.css"/>
	<link rel="stylesheet" type="text/css" href="http://as.51jlt.com/style/base/comList.css"/>
	<link rel="stylesheet" type="text/css" href="http://as.51jlt.com/style/store/storeList.css"/>
    -->
    <script src="/javascript/jquery.js"></script>
    <script src="/javascript/base.js"></script>
    <link rel="stylesheet" type="text/css" href="/style/global.css"/>
	<link rel="stylesheet" type="text/css" href="/style/comList.css"/>
	<link rel="stylesheet" type="text/css" href="/style/storeList.css"/>
    <script type="text/javascript" src="http://api.map.baidu.com/api?v=2.0&ak=9eb423fd3236f57384cfbec655b3c7da"></script>
	<script type="text/javascript" src="http://developer.baidu.com/map/jsdemo/demo/convertor.js"></script>
</head>
<body>
<div id="container">
	<div class="alert-mark change-city">
		<ul>
			<li class="btn-div">
				<span>关闭</span>
			</li>
		
			
			<li>
				<dl>
					<dt>A</dt>
					
					<dd cityCode="100340800000000">安庆市</dd>
					
					<dd cityCode="100210300000000">鞍山市</dd>
					
				</dl>
			</li>
			
			
			<li>
				<dl>
					<dt>B</dt>
					
					<dd cityCode="100150800000000">巴彦淖尔市</dd>
					
					<dd cityCode="100220600000000">白山市</dd>
					
					<dd cityCode="100340300000000">蚌埠市</dd>
					
					<dd cityCode="100150200000000">包头市</dd>
					
					<dd cityCode="100130600000000">保定市</dd>
					
					<dd cityCode="100110000000000">北京市</dd>
					
					<dd cityCode="100210500000000">本溪市</dd>
					
				</dl>
			</li>
			
			
			<li>
				<dl>
					<dt>C</dt>
					
					<dd cityCode="100220100000000">长春市</dd>
					
					<dd cityCode="100430100000000">长沙市</dd>
					
					<dd cityCode="100320400000000">常州市</dd>
					
					<dd cityCode="100510100000000">成都市</dd>
					
					<dd cityCode="100130800000000">承德市</dd>
					
					<dd cityCode="100150400000000">赤峰市</dd>
					
					<dd cityCode="100500000000000">重庆市</dd>
					
				</dl>
			</li>
			
			
			<li>
				<dl>
					<dt>D</dt>
					
					<dd cityCode="100210200000000">大连市</dd>
					
					<dd cityCode="100230600000000">大庆市</dd>
					
					<dd cityCode="100210600000000">丹东市</dd>
					
				</dl>
			</li>
			
			
			<li>
				<dl>
					<dt>E</dt>
					
					<dd cityCode="100150600000000">鄂尔多斯市</dd>
					
				</dl>
			</li>
			
			
			<li>
				<dl>
					<dt>F</dt>
					
					<dd cityCode="100350100000000">福州市</dd>
					
					<dd cityCode="100210400000000">抚顺市</dd>
					
					<dd cityCode="100210900000000">阜新市</dd>
					
				</dl>
			</li>
			
			
			<li>
				<dl>
					<dt>G</dt>
					
					<dd cityCode="100440100000000">广州市</dd>
					
					<dd cityCode="100520100000000">贵阳市</dd>
					
				</dl>
			</li>
			
			
			<li>
				<dl>
					<dt>H</dt>
					
					<dd cityCode="100230100000000">哈尔滨市</dd>
					
					<dd cityCode="100460100000000">海口市</dd>
					
					<dd cityCode="100130400000000">邯郸市</dd>
					
					<dd cityCode="100330100000000">杭州市</dd>
					
					<dd cityCode="100340100000000">合肥市</dd>
					
					<dd cityCode="100230400000000">鹤岗市</dd>
					
					<dd cityCode="100131100000000">衡水市</dd>
					
					<dd cityCode="100150100000000">呼和浩特市</dd>
					
					<dd cityCode="100150700000000">呼伦贝尔市</dd>
					
					<dd cityCode="100330500000000">湖州市</dd>
					
					<dd cityCode="100320800000000">淮安市</dd>
					
				</dl>
			</li>
			
			
			
			<li>
				<dl>
					<dt>J</dt>
					
					<dd cityCode="100230300000000">鸡西市</dd>
					
					<dd cityCode="100220200000000">吉林市</dd>
					
					<dd cityCode="100370100000000">济南市</dd>
					
					<dd cityCode="100230800000000">佳木斯市</dd>
					
					<dd cityCode="100330400000000">嘉兴市</dd>
					
					<dd cityCode="100330700000000">金华市</dd>
					
					<dd cityCode="100210700000000">锦州市</dd>
					
				</dl>
			</li>
			
			
			<li>
				<dl>
					<dt>K</dt>
					
					<dd cityCode="100530100000000">昆明市</dd>
					
				</dl>
			</li>
			
			
			<li>
				<dl>
					<dt>L</dt>
					
					<dd cityCode="100620100000000">兰州市</dd>
					
					<dd cityCode="100131000000000">廊坊市</dd>
					
					<dd cityCode="100331100000000">丽水市</dd>
					
					<dd cityCode="100320700000000">连云港市</dd>
					
					<dd cityCode="100211000000000">辽阳市</dd>
					
				</dl>
			</li>
			
			
			<li>
				<dl>
					<dt>M</dt>
					
					<dd cityCode="100231000000000">牡丹江市</dd>
					
				</dl>
			</li>
			
			
			<li>
				<dl>
					<dt>N</dt>
					
					<dd cityCode="100360100000000">南昌市</dd>
					
					<dd cityCode="100320100000000">南京市</dd>
					
					<dd cityCode="100450100000000">南宁市</dd>
					
					<dd cityCode="100320600000000">南通市</dd>
					
					<dd cityCode="100330200000000">宁波市</dd>
					
				</dl>
			</li>
			
			
			
			
			<li>
				<dl>
					<dt>B</dt>
					
					<dd cityCode="100230900000000">七台河市</dd>
					
					<dd cityCode="100230200000000">齐齐哈尔市</dd>
					
					<dd cityCode="100130300000000">秦皇岛市</dd>
					
					<dd cityCode="100370200000000">青岛市</dd>
					
					<dd cityCode="100330800000000">衢州市</dd>
					
				</dl>
			</li>
			
			
			
			<li>
				<dl>
					<dt>S</dt>
					
					<dd cityCode="100460200000000">三亚市</dd>
					
					<dd cityCode="100440500000000">汕头市</dd>
					
					<dd cityCode="100310000000000">上海市</dd>
					
					<dd cityCode="100330600000000">绍兴市</dd>
					
					<dd cityCode="100440300000000">深圳市</dd>
					
					<dd cityCode="100210100000000">沈阳市</dd>
					
					<dd cityCode="100130100000000">石家庄市</dd>
					
					<dd cityCode="100230500000000">双鸭山市</dd>
					
					<dd cityCode="100220300000000">四平市</dd>
					
					<dd cityCode="100220700000000">松原市</dd>
					
					<dd cityCode="100320500000000">苏州市</dd>
					
					<dd cityCode="100321300000000">宿迁市</dd>
					
					<dd cityCode="100231200000000">绥化市</dd>
					
				</dl>
			</li>
			
			
			<li>
				<dl>
					<dt>T</dt>
					
					<dd cityCode="100331000000000">台州市</dd>
					
					<dd cityCode="100140100000000">太原市</dd>
					
					<dd cityCode="100321200000000">泰州市</dd>
					
					<dd cityCode="100130200000000">唐山市</dd>
					
					<dd cityCode="100120000000000">天津市</dd>
					
					<dd cityCode="100220500000000">通化市</dd>
					
					<dd cityCode="100150500000000">通辽市</dd>
					
				</dl>
			</li>
			
			
			
			
			<li>
				<dl>
					<dt>W</dt>
					
					<dd cityCode="100330300000000">温州市</dd>
					
					<dd cityCode="100150300000000">乌海市</dd>
					
					<dd cityCode="100150900000000">乌兰察布市</dd>
					
					<dd cityCode="100650100000000">乌鲁木齐市</dd>
					
					<dd cityCode="100320200000000">无锡市</dd>
					
					<dd cityCode="100340200000000">芜湖市</dd>
					
					<dd cityCode="100420100000000">武汉市</dd>
					
				</dl>
			</li>
			
			
			<li>
				<dl>
					<dt>X</dt>
					
					<dd cityCode="100610100000000">西安市</dd>
					
					<dd cityCode="100630100000000">西宁市</dd>
					
					<dd cityCode="100350200000000">厦门市</dd>
					
					<dd cityCode="100130500000000">邢台市</dd>
					
					<dd cityCode="100320300000000">徐州市</dd>
					
				</dl>
			</li>
			
			
			<li>
				<dl>
					<dt>Y</dt>
					
					<dd cityCode="100370600000000">烟台市</dd>
					
					<dd cityCode="100320900000000">盐城市</dd>
					
					<dd cityCode="100321000000000">扬州市</dd>
					
					<dd cityCode="100640100000000">银川市</dd>
					
					<dd cityCode="100210800000000">营口市</dd>
					
				</dl>
			</li>
			
			
			<li>
				<dl>
					<dt>Z</dt>
					
					<dd cityCode="100130700000000">张家口市</dd>
					
					<dd cityCode="100321100000000">镇江市</dd>
					
					<dd cityCode="100410100000000">郑州市</dd>
					
					<dd cityCode="100330900000000">舟山市</dd>
					
					<dd cityCode="100440400000000">珠海市</dd>
					
				</dl>
			</li>
			
			
		
		</ul>
	</div>
	
	<div class="alert-mark alert-search">
		<dl class="search-div clearfix">
			<dt><input id="keyValue" name="keyValue" type="text" value="" placeholder="请输入商家名，服务项目或区域名"/></dt>
			<dd>
				<span><a id="searchBtn" href="javascript:;">搜索</a></span>
				<span><a href="javascript:;" class="search-cancel">取消</a></span>
			</dd>
		</dl>
	</div>
		<div class="header-fixed">	
		<div class="header">
			<span class="changeCityBtn">
				<input type="hidden" id="cityCode" value="北京市"/>
				<span>北京市</span><i class="iconfont">&#xe611;</i>
			</span>
			<span class="store-title">附近</span>
			<span class="zoomBtn"><span></span></span>
		</div>  
		
		<!---->
		<nav data-am-widget="menu" class="am-menu  am-menu-default">
		  <a href="javascript: void(0)" class="am-menu-toggle">
		    <i class="am-menu-toggle-icon am-icon-bars"></i>
		  </a>
		  <ul class="am-menu-nav am-avg-sm-3">
		    <li class="am-parent">
		      <a href="javascript:;" class="area">按区域</a>
		      <ul id="areaId" value="" class="am-menu-sub am-collapse  am-avg-sm-3 ul-liw oliclick" ></ul>
		    </li>
		    
		    <li class="am-parent">
		      <a href="javascript:;" class="sequence">智能排序</a>
		      <ul id="autoSearchType" value="0" class="am-menu-sub am-collapse  am-avg-sm-3 ul-oneColumn smart-sort">
		        <li value="0">智能排序</li>
		        <li value="1">距离最近</li>
		      </ul>
		    </li>
		    <li class="am-parent" style="display:none;">
		      <a href="javascript:;" class="filter">筛&nbsp;选</a>
		      <ul id="screenType" value="0" class="am-menu-sub am-collapse am-avg-sm-1 ul-oneColumn ul-Filter">
		        <li class=""><span value="0" >筛&nbsp;选</span></li>
		        <li class="to-store"><span value="1" >预约到店</span><e>预约到店</e></li>
	 	        <!--<li value="2"><span></span></li>-->
		        <li class="to-coupon"><span value="3">优惠券</span><e>优惠券</e></li>
		      </ul>
		    </li>
		 </ul>
	   </nav>
	</div>	
	<!--
	<div class="advert-w" >
		<div class="banner"  >
		    <ul>
		    	<li class="slides"><img src="/images/public/default_ad.jpg"/></li>
		    </ul>
		</div>
	</div>
    -->
	
	<div id="shop_list" class="list_box" style="margin-top: 98px"></div>
	<div id="tips"></div>
</div>

<div class="nav-box">
	<nav>
		<div class="to-shop-btn"><span class="store-img active"></span></div>
		<div class="to-door-btn"><span class="door-img"></span></div>
		<div class="order-btn"><span class="order-img"></span></div>
		<div class="customer-center-btn"><span class="people-img"></span></div>
	</nav>
</div>
<div id="loading_img" class="loading_img">
	<img src="/images/public/loading.svg" width="50" alt="">
</div>
<div id="allmap"></div>

<!--在这里编写你的代码-->
<script type="text/javascript">
	var sessionStorage = window.sessionStorage;
	//选择区域
	function setArea(obj){
		//alert();
		$("#areaId").attr({"value":$(obj).attr("value")});
		$(obj).parent().siblings("a").html($(obj).html());
		$(obj).parent().parent(".am-parent").removeClass("am-open").children("ul").removeClass("am-in");
		shopListSize = 0;
		getShopList(0,pageSize);
	};
	
	var lat = 0.0;
	var lng = 0.0;
	var timestamp = "";
	var nonceStr = "";
	var signature = "";
		
	var shopTotalCount = 0;//服务项目总数
	var shopListSize = 0; //已经加载服务项目条数
	var canLoad = true;
	
	
	//根据CityCode获取area
	function getAreaList(){
		$.ajax({
	 		type:"post",
	 		dataType:"json",
	 		data:{
				cityCode:$("#cityCode").val()
				//cityCode:"北京市"
	 		},
	 		url:localhostPath + "/area/areaList.do",
			//url:"http://as.51jlt.com/area/areaList.php",
	 		success:function(data){
	 			var jsonData = eval(data);
	 			if(1 == jsonData.Code){
	 				$("#areaId").empty();
	 				var areaListLength = jsonData.Result.length;
	 				var areaList = jsonData.Result;
	 				var dom="<li onclick='setArea(this)' value=''>全部区域</li>";
	 				for(var i=0; i < areaListLength; i++){
	 					dom += '<li onclick="setArea(this)" value='+ areaList[i].areaId +'>'+ areaList[i].areaCode +'</li>';
	 				}
	 				$("#areaId").html(dom);
	 			}else{
	 				alert(jsonData.Tips);
	 				$("#areaId").empty();
	 				return false;
	 			}
	 		},
	 		error:function(){
	 			alert("网络异常，稍后重试");
	 			$("#areaId").empty();
	 			return false;
	 		}
	 	});
	}
	//  选择城市
		$(".changeCityBtn").click(function(){
			$(".change-city").show();
			$("#shop_list").css({height:"100px"});
		});
		$(".btn-div span").click(function(){
			$(".change-city").hide();
			$("#shop_list").css({height:"auto"});
		});
		$(".change-city dd").each(function(){
			$(this).click(function(){
				var thisHtml=$(this).html();
				$(".change-city").hide();
				$("#shop_list").css({height:"auto"});
				$("#cityCode").val(thisHtml);
				$(".changeCityBtn span").html(thisHtml);
				$("nav .am-parent a.area").html("按区域");
				$("nav .am-parent a.sequence").html("智能排序");
				$("nav .am-parent a.filter").html("筛&nbsp;选");
				cityCode = thisHtml;
				getAreaList();
				shopListSize = 0;
				getShopList(0,pageSize);
			});
		});
		//$("#cityCode").val("北京市");
		//getAreaList();
		
	
	
	//获取店铺列表
	function getShopList(page,pageSizes){
		if(!canLoad){
			return false;
		}
		canLoad = false;
		$("#loading_img").show();
		$("#tips").empty();
		$.ajax({
			async:true,
	 		cache:false,
	 		type:"post",
	 		dataType:"json",
	 		data:{
	 			page:page,
	 			pageSize:pageSizes,
				cityCode:cityCode,
				lng:lng,
				lat:lat,
				areaId:$('#areaId').attr("value"), //区域搜索区域主键areaId值
				autoSearchType:$('#autoSearchType').attr("value"),//智能排序类型(默认传“”或0，1：按距离；2：按优惠；3：按人气(collectCount * 1 + shareCount * 2 + commentCount * 2 + preOrderCount * 4)；)
				screenType:$('#screenType').attr("value"), //screenType:筛选类型（0:没有筛选条件；1：可预约到店；2.可预约上门；3.有红包；）
				keyValue:$("#keyValue").val()
	 		},
	 		url:localhostPath + "/area/shopList.do",
	 		success:function(data){
	 			$("#loading_img").fadeOut("slow");
	 			var jsonData = eval(data);
	 			if(jsonData.Code == 1){
					var shopListData = jsonData.Data.shopData;
					var shopList = $("#shop_list");
					var dom = '';
					
					for(var i = 0; i < jsonData.Data.shopListSize; i++){
						var toShop = '';
						var toDoor = '';
						var redPackets = '';
						var hasPriceDiscount = '';
						if(shopListData[i].canShopService == 1){
							toShop = '<span class="store">预约到店</span>';
						}
						if(shopListData[i].canMasseurService == 1){
							toShop = '<span class="door">预约上门</span>';
						}
						if(shopListData[i].hasRedPackets == 1){
							//redPackets = '<span class="paper">红包</span>';
							redPackets = '<span class="paper">优惠券</span>';
						}
//						if(1 == shopListData[i].hasPriceDiscount){
//							hasPriceDiscount = "起";
//						}
					hasPriceDiscount = "起";
						//var imgSrc =  localhostPath + "/images/img/store.png";
						var imgSrc =  shopListData[i].listImageUrl;
						if(null == imgSrc || "" == imgSrc){
							imgSrc = localhostPath +"/images/public/default_store.jpg";
						}
						var minPrice = "";
						var preOrder = "";
	//					if(6 != shopListData[i].type){
//							minPrice = '<div class="subscribe">'+ toShop + toDoor + redPackets +'</div>'+
//				 					'<span class="minPrice"><e>'+ shopListData[i].lowestItemPrice +'元</e><e id="hasPriceDiscount">'+ hasPriceDiscount +'</e></span>';
//					 				
//				 		preOrder = '<div class="bespoke"><span>'+ shopListData[i].preOrderCount +'</span>人预约</div>';
//						}
						var spaceDom = "";
						if(null != shopListData[i].location && "" != shopListData[i].location){
							spaceDom = "&nbsp;&nbsp";
						}
						dom += '<div class="con_list" shopId = "'+ shopListData[i].shopId +'" onclick="shopDetail(this)">'+
			 					'<dl>'+
			 						'<dt class="resizes"><img src="'+ imgSrc +'" /></dt>'+
			 						'<dd class="storeName"><h2>'+ shopListData[i].name +'</h2></dd>'+
			 						'<dd>'+ minPrice +
			 						'</dd>'+
			 						'<dd class="last-dd">'+
			 							'<div class="distance"><span>'+ shopListData[i].location +'</span>'+ spaceDom +'<span>'+ shopListData[i].longth +'</span></div>'+
			 							preOrder +
			 						'</dd>'+
			 						'<div class="clears"></div>'+
			 					'</dl>'+
			 				'</div>';
					}

					if(0 == page){
						shopList.empty();
					}
					shopList.append(dom);
					
					shopTotalCount = jsonData.Data.shopTotalCount;
					shopListSize += jsonData.Data.shopListSize;
					
					sessionStorage.setItem("jsonData",jsonData);
					sessionStorage.setItem("page",page);
					sessionStorage.setItem("pageSize",pageSizes);
					sessionStorage.setItem("cityCode",cityCode);
					sessionStorage.setItem("lng",lng);
					sessionStorage.setItem("lat",lat);
					sessionStorage.setItem("areaId",$('#areaId').attr("value"));
					sessionStorage.setItem("autoSearchType",$('#autoSearchType').attr("value"));
					sessionStorage.setItem("screenType",$('#screenType').attr("value"));
					sessionStorage.setItem("keyValue",$("#keyValue").val());
					
					//广告
	//				var adListData = jsonData.Data.adData;
//					if(adListData.length > 0){
//						var oLi = "";
//	 				for(var i = 0; i<adListData.length; i++){
//	 					oLi += '<li class="slides" onclick="adJump(this)" adType="'+adListData[i].adType+'" adValue="'+adListData[i].adValue+'"><img src="'+ adListData[i].adImageUrl +'"/></li>';
//	 				}
	 				//$(".banner ul li").remove();
	 				//$(".banner ol").remove();
	 				//$(".banner ul").html(oLi);
	 				////$(".advert-w").css({height:$(".banner").height()+"px", oveflow:"hidden"});
					//$('.banner').unslider({
					//	speed: 500,               
					//	delay:3000,              
					//	keys: true,               
					//	dots: true,               
					//	fluid: true             
					//});
					//}
				}else{
					$("#loading_img").fadeOut("slow");
					alert(jsonData.Tips);
					return false;
				}
				canLoad = true;
	 		},
	 		error:function(data) {
	 			canLoad = true;
	 			$("#loading_img").fadeOut("slow");
	 			alert("网络异常，稍后重试！");
	 			return false;
	 		}
		});
	}	

		//店铺详情
	function shopDetail(obj){
		var shopId = $(obj).attr("shopId");
		if(null == shopId || "" == $.trim(shopId) || shopId <= 0){
			alert("请选择要查看的店铺！");
			return false;
		}else{
			//window.location = localhostPath + "/shop/"+shopId+"/"+lng+"/"+lat+"/shopDetail.php";
			window.location = localhostPath + "/shopDetail.html?shopId="+shopId+"&lng="+lng+"&lat="+lat+"";
		}
	}
	
//	function myFun(result){
//		var cityName = result.name;
//		//map.setCenter(cityName);
//		//alert("当前定位城市:"+cityName);
//		$(".changeCityBtn span").html(cityName);
//		$("#cityCode").val(cityName);
//		getAreaList();
//	}
	
	$(function(){
		var sessionPage = sessionStorage.getItem("page");
		var sessionPageSize = sessionStorage.getItem("pageSize");
		var sessionCityCode = sessionStorage.getItem("cityCode");
		var sessionLng = sessionStorage.getItem("lng");
		var sessionLat = sessionStorage.getItem("lat");
		var sessionAreaId = sessionStorage.getItem("areaId");
		var sessionAutoSearchType =	sessionStorage.getItem("autoSearchType");
		var sessionScreenType =	sessionStorage.getItem("screenType");
		var sessionKeyValue = sessionStorage.getItem("keyValue");		
		
		if(null != sessionAutoSearchType){
			$("#autoSearchType li").each(function(){
				if($(this).attr("value") == sessionAutoSearchType){
					$(".sequence").html($(this).html());
					$("#autoSearchType").attr("value",sessionAutoSearchType);
				}
			});
		}
		
		if(null != sessionScreenType){
			$("#screenType li span").each(function(){
				if($(this).attr("value") == sessionScreenType){
					$(".filter").html($(this).html());
					$("#screenType").attr("value",sessionScreenType);
				}
			});
		}
		if(null != sessionKeyValue){
			$("#keyValue").val(sessionKeyValue);
		}

		
		// 百度地图API功能
		var geolocation = new BMap.Geolocation();
		geolocation.getCurrentPosition(function(r){
			if(this.getStatus() == BMAP_STATUS_SUCCESS){
				lng = r.point.lng;
				lat = r.point.lat;
// 				var myCity = new BMap.LocalCity();
// 		    	myCity.get(myFun);
		    	var point = new BMap.Point(lng,lat);
		    	var gc = new BMap.Geocoder();
				gc.getLocation(point, function(rs){
				   var addComp = rs.addressComponents;
				   //alert(addComp.province + ", " + addComp.city + ", " + addComp.district + ", " + addComp.street + ", " + addComp.streetNumber);
				   $(".changeCityBtn span").html(addComp.city);
					$("#cityCode").val(addComp.city);	
					getAreaList();
					
					cityCode=addComp.city;
					getShopList(0,pageSize);
				});
		    	
		    	//保存地区收索条件
		    	if(null != sessionAreaId){
					$("#areaId li").each(function(){
						if($(this).attr("value") == sessionAreaId){
							$("#areaId").attr({"value":sessionAreaId});
							$(this).parent().siblings("a").html($(this).html());
							$(this).parent().parent(".am-parent").removeClass("am-open").children("ul").removeClass("am-in");
						}
					});
				}
		    	if(null != sessionCityCode){
					$("#cityCode").val(sessionCityCode);
				}
		    
	    		shopListSize = 0;
		        getShopList(0,pageSize);
			} else {
				//alert('failed'+this.getStatus());
		    	shopListSize = 0;
			    getShopList(0,pageSize);
			}        
		},{enableHighAccuracy: true});
		
		
		
		timestamp = '1437626273';
		nonceStr = 'ae93f20e-117f-4018-b282-567aaf0a5000';
		signature = '385dd6fd4c61219074067bdaa94f547dd1bb569c';
		appId = 'wxd544d4718702cd55';
		if(isWeixin){
			// console.log("1.默认加载, timestamp = " + timestamp + ", nonceStr = " + nonceStr + ", signature = " + signature);
			wx.config({
			    debug: false, // 开启调试模式,调用的所有api的返回值会在客户端alert出来，若要查看传入的参数，可以在pc端打开，参数信息会通过log打出，仅在pc端时才会打印。
			    appId: appId, // 必填，公众号的唯一标识
			    timestamp: timestamp, // 必填，生成签名的时间戳
			    nonceStr: nonceStr, // 必填，生成签名的随机串
			    signature: signature,// 必填，签名，见附录1
			    jsApiList: [
							'checkJsApi',
							'onMenuShareTimeline',
							'onMenuShareAppMessage',
							'onMenuShareQQ',
							'onMenuShareWeibo',
							'hideMenuItems',
							'showMenuItems',
							'hideAllNonBaseMenuItem',
							'showAllNonBaseMenuItem',
							'translateVoice',
							'startRecord',
							'stopRecord',
							'onRecordEnd',
							'playVoice',
							'pauseVoice',
							'stopVoice',
							'uploadVoice',
							'downloadVoice',
							'chooseImage',
							'previewImage',
							'uploadImage',
							'downloadImage',
							'getNetworkType',
							'openLocation',
							'getLocation',
							'hideOptionMenu',
							'showOptionMenu',
							'closeWindow',
							'scanQRCode',
							'chooseWXPay',
							'openProductSpecificView',
							'addCard',
							'chooseCard',
							'openCard'
						] // 必填，需要使用的JS接口列表，所有JS接口列表见附录2
			});
			wx.ready(function(){
			    // config信息验证后会执行ready方法，所有接口调用都必须在config接口获得结果之后，config是一个客户端的异步操作，所以如果需要在页面加载时就调用相关接口，则须把相关接口放在ready函数中调用来确保正确执行。对于用户触发时才调用的接口，则可以直接调用，不需要放在ready函数中。
// 				wx.getLocation({
// 				    success: function (res) {
// 				        var latitude = res.latitude; // 纬度，浮点数，范围为90 ~ -90
// 				        var longitude = res.longitude; // 经度，浮点数，范围为180 ~ -180。
// 				        //var speed = res.speed; // 速度，以米/每秒计
// 				        //var accuracy = res.accuracy; // 位置精度
// 				        lng = longitude;
// 				        lat = latitude;
// 				        //微信经纬度转百度经纬度start				        
// 				        var gpsPoint = new BMap.Point(lng,lat);
// 				        //地图初始化
// 				        var bm = new BMap.Map("allmap");
// 				        bm.centerAndZoom(gpsPoint, 15);
// 				        bm.addControl(new BMap.NavigationControl());
// 				        BMap.Convertor.translate(gpsPoint,0,translateCallback);
// 				      微信经纬度转百度经纬度end
				        
// 				    },
// 				    cancel: function (res) {
// 				    	shopListSize = 0;
// 				    	getShopList(0,pageSize);
// 				    },
// 				    fail:function(res){
// 				    	//alert("fail");
// 				    	shopListSize = 0;
// 				    	getShopList(0,pageSize);
// 				    }
// 				}); 
				wx.onMenuShareAppMessage({
				    title: '按爽-专业中医推拿按摩O2O平台', // 分享标题
				    desc: '上门预约 到店消费 名医专家 企业定制 一号搞定！', // 分享描述
				    link: 'http://as.51jlt.com/shop/toShop.php', // 分享链接
				    imgUrl: 'http://file.51jlt.com/fileUrl/upload/image/icon/anshuang_icon_44.png', // 分享图标
				    type: 'link', // 分享类型,music、video或link，不填默认为link
				    dataUrl: '', // 如果type是music或video，则要提供数据链接，默认为空
				    success: function () { 
				        // 用户确认分享后执行的回调函数
				    },
				    cancel: function () { 
				        // 用户取消分享后执行的回调函数
				    }
				});
				
				wx.onMenuShareTimeline({
					title: '按爽-专业中医推拿按摩O2O平台', // 分享标题
				    link: 'http://as.51jlt.com/shop/toShop.php', // 分享链接
				    imgUrl: 'http://file.51jlt.com/fileUrl/upload/image/icon/anshuang_icon_44.png', // 分享图标
				    success: function () { 
				        // 用户确认分享后执行的回调函数
				    },
				    cancel: function () { 
				        // 用户取消分享后执行的回调函数
				    }
				});
				wx.onMenuShareQQ({
					title: '按爽-专业中医推拿按摩O2O平台', // 分享标题
				    desc: '上门预约 到店消费 名医专家 企业定制 一号搞定！', // 分享描述
				    link: 'http://as.51jlt.com/shop/toShop.php', // 分享链接
				    imgUrl: 'http://file.51jlt.com/fileUrl/upload/image/icon/anshuang_icon_44.png', // 分享图标
				    success: function () { 
				       // 用户确认分享后执行的回调函数
				    },
				    cancel: function () { 
				       // 用户取消分享后执行的回调函数
				    }
				});
				wx.onMenuShareWeibo({
					title: '按爽-专业中医推拿按摩O2O平台', // 分享标题
				    desc: '上门预约 到店消费 名医专家 企业定制 一号搞定！', // 分享描述
				    link: 'http://as.51jlt.com/shop/toShop.php', // 分享链接
				    imgUrl: 'http://file.51jlt.com/fileUrl/upload/image/icon/anshuang_icon_44.png', // 分享图标
				    success: function () { 
				       // 用户确认分享后执行的回调函数
				    },
				    cancel: function () { 
				        // 用户取消分享后执行的回调函数
				    }
				});
			});
			wx.error(function(res){
			    // config信息验证失败会执行error函数，如签名过期导致验证失败，具体错误信息可以打开config的debug模式查看，也可以在返回的res参数中查看，对于SPA可以在这里更新签名。
				
			});
		}else{
			
		}
		
	//  选择城市
		$(".changeCityBtn").click(function(){
			$(".change-city").show();
			$("#shop_list").css({height:"100px"});
		});
		$(".btn-div span").click(function(){
			$(".change-city").hide();
			$("#shop_list").css({height:"auto"});
		});
		$(".change-city dd").each(function(){
			$(this).click(function(){
				var thisHtml=$(this).html();
				$(".change-city").hide();
				$("#shop_list").css({height:"auto"});
				$("#cityCode").val(thisHtml);
				$(".changeCityBtn span").html(thisHtml);
				$("nav .am-parent a.area").html("按区域");
				$("nav .am-parent a.sequence").html("智能排序");
				$("nav .am-parent a.filter").html("筛&nbsp;选");
				cityCode = thisHtml;
				getAreaList();
				shopListSize = 0;
				getShopList(0,pageSize);
			});
		});
		//$("#cityCode").val("北京市");
		//getAreaList();
		
		//排序
		$(".smart-sort li").click(function(){
			$(this).parent().attr({"value":$(this).attr("value")});
			$(this).parent().siblings("a").html($(this).html());
			$(this).parent().parent(".am-parent").removeClass("am-open").children("ul").removeClass("am-in");
			shopListSize = 0;
			getShopList(0,pageSize);
		});
		//筛选；
		$(".ul-Filter li").click(function(){
			$(this).parent().attr({"value":$(this).children("span").attr("value")});
			$(this).parent().siblings("a").html($(this).children("span").html());
			$(this).parent().parent(".am-parent").removeClass("am-open").children("ul").removeClass("am-in");
			shopListSize = 0;
			getShopList(0,pageSize);
		});
		
		//  搜索
		$(".zoomBtn").click(function(){
			$(".alert-search").show();
			$(".alert-search").css({width:"100%","height":$(window).height(),overflow:"hidden", "oveflow-y":"scroll"});
			$("#container").css({"height":$(window).height()});
		});
		$(".search-cancel").click(function(){
			$(".alert-search").hide();
			$(".alert-search").css({width:"auto",height:"auto"});
			$("#container").css({height:"auto"});
		});
		
		$("#searchBtn").click(function(){
			$(".search-cancel").click();
			shopListSize = 0;
			getShopList(0,pageSize);
		});
	});

//定义一个总的高度变量
	var totalheight = 0;  
	function load(){ 
	    totalheight = parseFloat($(window).height()) + parseFloat($(window).scrollTop()); //浏览器的高度加上滚动条的高度 
	    if ($(document).height() <= totalheight){ //当文档的高度小于或者等于总的高度的时候，开始动态加载数据
	        //加载数据
			if(shopTotalCount <= shopListSize){
				//alert("没有可以加载的数据了！");
				$("#tips").html("没有可以加载的数据了");
				return false;
			}else{
				getShopList(shopListSize,pageSize);
			}
	    } 
	} 
	$(window).scroll( function() { 
	    load();
	}); 
</script>


<!--[if (gte IE 9)|!(IE)]><!-->

<!--<![endif]-->
<!--[if lte IE 8 ]>
<script src="http://libs.baidu.com/jquery/1.11.3/jquery.min.js"></script>
<script src="http://cdn.staticfile.org/modernizr/2.8.3/modernizr.js"></script>
<script src="assets/js/amazeui.ie8polyfill.min.js"></script>
<![endif]-->
<script src="assets/js/amazeui.min.js"></script>
</body>
</html>